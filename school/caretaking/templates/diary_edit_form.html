{% extends "diary_add_form.html" %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
      <li class="breadcrumb-item">
          <a href="/">home</a>
      </li>
      <li class="breadcrumb-item">
          <a href="{% url 'caretaking' %}">caretaking</a>
      </li>
      <li class="breadcrumb-item">
          <a href="{% url 'staff-detail' staff.user.username %}">{{ staff.user.username }}</a>
      </li>
      <li class="breadcrumb-item">
          <a href="{% url 'diary-list' staff.user.username %}">diary</a>
      </li>
      <li class="breadcrumb-item">
          <a href="{{ object.get_absolute_url }}">{{ object.day|date:"D j N Y" }}</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
          edit
      </li>
  </ol>
</nav>
{% endblock %}

{% block actions %}
    <div class="float-right">
        <a href="{{ object.get_absolute_url }}" class="action">
        <i class="fa fa-reply"></i>
        <span class="sr-only">Back to diary entry<span>
        </a>
    </div>
{% endblock %}

{% block list_title %}Edit Diary Entry: {{ object.day|date:"D j N Y" }}{% endblock %}

{% block tasks %}
    <div class="task-list">
        <ul class="task-list">
        {% for task in object.tasks %}
        <li contenteditable="true" data-id="{{ task.pk }}">
                {{ task.description }}
            </li>
        {% endfor %}
        </ul>
        <div id="debug"></div>
    </div>
{% endblock %}

{% block extra_button %}
    <button class="btn btn-secondary" type="cancel">
        <i class="fa fa-reply"></i> Cancel
    </button>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('keydown', function (event) {
  var esc = event.which == 27,
      nl = event.which == 13,
      el = event.target,
      input = el.nodeName != 'INPUT' && el.nodeName != 'TEXTAREA',
      data = {};

  if (input) {
    if (esc) {
      // restore state
      document.execCommand('undo');
      el.blur();
    } else if (nl) {
      // save
      data[el.getAttribute('data-id')] = el.innerHTML;

      // we could send an ajax request to update the field
      /*
      $.ajax({
        url: window.location.toString(),
        data: data,
        type: 'post'
      });
      */
      log(JSON.stringify(data));

      el.blur();
      event.preventDefault();
    }
  }
}, true);

function log(s) {
  document.getElementById('debug').innerHTML = 'value changed to: ' + s;
}
</script>
{% endblock extra_js %}
